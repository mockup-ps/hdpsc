(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[31],{638:function(e,t,n){"use strict";var c=n(679),s=Object(c.a)("https://ctvjpxocqeajngziaxji.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyMzE4Mjc3OSwiZXhwIjoxOTM4NzU4Nzc5fQ.pCQD8_U0cgWJtgLbOh90kUGpxpOmpwzDmsfwKzj7PwE");t.a=s},670:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));for(var c,s=256,a=[];s--;)a[s]=(s+256).toString(16).substring(1);function i(e){var t=0,n=e||11;if(!c||s+n>512)for(c="",s=0;t<256;t++)c+=a[256*Math.random()|0];return c.substring(s,s+++n)}},793:function(e,t,n){"use strict";n.r(t);var c=n(664),s=n(634),a=n.n(s),i=n(639),r=n(164),l=n(43),d=n(630),o=n(628),j=n(1),u=n(162),b=n(638),f=n(19),O=n(648),h=n.n(O),x=n(670),m=n(20),k=function(){return Object(m.jsx)("div",{className:"d-flex flex-row justify-content-center",children:Object(m.jsx)("div",{children:Object(m.jsx)(o.f,{className:"btn btn-sm btn-success",children:Object(m.jsx)("i",{class:"fas fa-eye"})})})})},p=function(e){var t=Object(f.g)(),n=Object(u.c)((function(e){return e.trigger})),c=Object(j.useState)(!1),s=Object(d.a)(c,2),O=s[0],k=s[1],p=Object(u.b)(),y=Object(j.useState)([]),_=Object(d.a)(y,2),g=_[0],v=_[1],w=Object(j.useState)(!1),N=Object(d.a)(w,2),C=N[0],S=N[1],I=Object(j.useState)([]),D=Object(d.a)(I,2),K=D[0],A=D[1],B=(Object(u.c)((function(e){return e.simView})),function(e){v(Object(l.a)(Object(l.a)({},g),{},Object(r.a)({},e.target.name,e.target.value)))}),M=function(){var e=Object(i.a)(a.a.mark((function e(t,c){var s,i,r,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.target.files[0],console.log(c),e.next=4,b.a.storage.from("dokumen").upload(Object(x.a)(32),s);case 4:if(i=e.sent,r=i.data,!i.error){e.next=11;break}alert("Error"),e.next=17;break;case 11:return l="https://ctvjpxocqeajngziaxji.supabase.co/storage/v1/object/public/"+r.Key,console.log(l),e.next=15,b.a.from("td_deficiency").update({url_doc:l}).eq("id_deficiency",c);case 15:e.sent.error||(h.a.fire({icon:"success",title:"Sukses",timer:300}),p({type:"set",trigger:n+1}));case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(j.useEffect)(Object(i.a)(a.a.mark((function t(){var n,c,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.a.from("td_deficiency").select("\n        data, \n        data_cap,\n        id_deficiency,\n        url_doc\n        ").eq("id_detensi",e.datadetensi.id_detensi);case 2:n=t.sent,c=n.data,n.error,s=c.map((function(e){var t;return Object(l.a)(Object(l.a)({},e.data),{},(t={},Object(r.a)(t,"data_cap",e.data_cap),Object(r.a)(t,"id_deficiency",e.id_deficiency),Object(r.a)(t,"certificatetitle",e.data.certificate.label),Object(r.a)(t,"url_doc",e.url_doc),t))})),A(s.sort((function(e,t){return e.id_deficiency-t.id_deficiency}))),v(s),console.log(g),console.log(s);case 10:case"end":return t.stop()}}),t)}))),[n]);var T=function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.from("td_deficiency").update({url_doc:null}).eq("id_deficiency",t);case 2:e.sent.error||(h.a.fire({icon:"success",title:"Sukses",timer:300}),p({type:"set",trigger:n+1}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(o.db,{size:"xl",show:C,onClose:function(){return S(!1)},children:[Object(m.jsx)(o.gb,{children:Object(m.jsx)("h5",{children:Object(m.jsx)("i",{children:"Correction Action Plan"})})}),Object(m.jsx)(o.eb,{children:Object(m.jsxs)("div",{className:"mt-1",children:[Object(m.jsx)("div",{className:"d-flex justify-content-end mb-1",children:Object(m.jsxs)(o.f,{disabled:O,onClick:function(){return t.push("/hdpsc/edit"),void p({type:"set",datadetensi:e.datadetensi})},className:"btn btn-info btn-sm",children:[Object(m.jsx)("i",{className:"fas fa-ship mr-2"}),"Kapal ",Object(m.jsx)("i",{children:"Release"})]})}),Object(m.jsx)(o.y,{addTableClasses:"josss",items:K,fields:[{key:"no",label:"No",_style:{width:"1%"}},{key:"natureofdeficiency",label:"Nature of Deficiency",_style:{width:"15%"}},{key:"actiontaken",label:"Code",_style:{width:"1%"}},{key:"issuingauthority",label:"Certificate / Issuer",_style:{width:"5%"}},{key:"actionplan",label:"Action Plan"},{key:"result",label:"Result"},{key:"remark",label:"Remarks",_style:{width:"12%"}},{key:"doc",label:"Docs"}],scopedSlots:{doc:function(e,t){if(e.url_doc)return Object(m.jsx)("td",{children:Object(m.jsxs)("div",{className:"d-flex justify-content-center",children:[Object(m.jsx)("a",{target:"_blank",href:e.url_doc,role:"button",className:"btn btn-info btn-sm mr-1",children:Object(m.jsx)("i",{class:"fas fa-file-download"})}),Object(m.jsx)(o.f,{disabled:O,onClick:function(){return T(e.id_deficiency)},className:"btn btn-danger btn-sm",children:Object(m.jsx)("i",{class:"fas fa-trash-alt"})})]})});var n=e.id_deficiency;return Object(m.jsx)("td",{children:Object(m.jsxs)("div",{className:"d-flex justify-content-center",children:[Object(m.jsx)("input",{onInput:function(e){return M(e,n)},type:"file",name:"upload",id:"file",class:"inputfile"}),Object(m.jsx)("label",{role:"button",className:"btn btn-success btn-sm",for:"file",children:Object(m.jsx)("i",{class:"far fa-file"})})]})})},issuingauthority:function(e,t){return Object(m.jsxs)("td",{children:[e.certificatetitle," / ",e.issuingauthority]})},result:function(e,t){return Object(m.jsx)("td",{children:Object(m.jsx)(o.Ib,{name:"result",onChange:function(e){return B(e)},disabled:O})})},remark:function(e,t){return Object(m.jsx)("td",{children:Object(m.jsxs)(o.ub,{name:"remark",onChange:function(e){return B(e)},disabled:O,children:[Object(m.jsx)("option",{value:"0",children:"NOT CLOSED"}),Object(m.jsx)("option",{value:"1",children:"CLOSED"})]})})},actiontaken:function(e,t){return Object(m.jsx)("td",{children:e.actiontaken.value})},responsiblero:function(e,t){return console.log(e),Object(m.jsx)("td",{children:e.responsiblero?"Yes":"No"})},no:function(e,t){return Object(m.jsx)("td",{children:t+1})},actionplan:function(e,t){return Object(m.jsx)("td",{children:Object(m.jsx)(o.Ib,{name:"actionplan",onChange:function(e){return B(e)},disabled:O})})}}})]})}),Object(m.jsx)(o.fb,{children:Object(m.jsxs)("div",{className:"d-flex justify-content-end",children:[Object(m.jsx)("div",{className:"mr-2",children:Object(m.jsx)(o.f,{onClick:function(){return S(!1)},color:"success",children:"Simpan"})}),Object(m.jsx)("div",{className:"mr-2",children:Object(m.jsx)(o.f,{onClick:function(){return S(!1)},color:"danger",children:"Batal"})})]})})]}),Object(m.jsxs)("div",{className:"d-flex flex-row justify-content-center",children:[4==e.datadetensi.kd_status?Object(m.jsx)("div",{className:"mr-2",children:Object(m.jsx)(o.f,{onClick:function(){t.push("/hdpsc/edit"),p({type:"set",datadetensi:e.datadetensi})},className:"btn btn-sm btn-success",children:Object(m.jsx)("i",{class:"fas fa-eye"})})}):Object(m.jsx)(m.Fragment,{}),Object(m.jsx)("div",{children:Object(m.jsx)(o.f,{onClick:function(){4==e.datadetensi.kd_status&&k(!0),S(!0)},className:"btn btn-sm btn-info",children:Object(m.jsx)("i",{class:"fas fa-wrench"})})})]})]})},y=function(e){var t=Object(f.g)(),n=Object(u.b)(),c=Object(u.c)((function(e){return e.simView}));return Object(m.jsxs)("div",{className:"d-flex flex-row justify-content-center",children:[e.disabled,Object(m.jsx)("div",{children:Object(m.jsx)("div",{children:Object(m.jsx)(o.f,{disabled:e.disabled,onClick:function(){e.datadetensi.fl_lock?(t.push("/hdpsc/edit"),n({type:"set",datadetensi:e.datadetensi})):h.a.fire({icon:"question",text:"Apakah Anda Yakin ingin Men-Check Out informasi ini ?",showConfirmButton:!0,showDenyButton:!0,denyButtonText:"Tidak",confirmButtonText:"Ya"}).then((function(s){s.isConfirmed&&function(){var s=Object(i.a)(a.a.mark((function s(i){var r,l;return a.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,b.a.from("td_detensi").update({fl_lock:1,locked_by:c}).eq("id_detensi",i);case 2:if((r=s.sent).data,!(l=r.error)){s.next=9;break}return s.abrupt("return",l);case 9:t.push("/hdpsc/edit"),n({type:"set",datadetensi:e.datadetensi});case 11:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()(e.datadetensi.id_detensi)}))},className:e.fl_lock&&e.disabled?"btn btn-sm btn-success":e.fl_lock?"btn btn-sm btn-warning":"btn btn-sm btn-success",children:e.fl_lock&&e.disabled?Object(m.jsx)("i",{class:"fas fa-check"}):e.fl_lock?Object(m.jsx)("i",{class:"fas fa-pencil-alt"}):Object(m.jsx)("i",{class:"fas fa-check"})})})})]})};t.default=function(){var e=Object(u.b)(),t=["Direktorat KPLP","Direktorat KAPEL","BKI","Kemenlu","Kemenkomarves"],n=Object(f.g)(),s=Object(j.useState)([]),O=Object(d.a)(s,2),x=O[0],_=O[1],g=Object(j.useState)([]),v=Object(d.a)(g,2),w=v[0],N=v[1],C=["success","primary","warning","info","danger","light"],S=Object(j.useState)(!1),I=Object(d.a)(S,2),D=I[0],K=I[1],A=Object(u.c)((function(e){return e.simView})),B=Object(j.useState)({}),M=Object(d.a)(B,2),T=M[0],P=M[1],q=function(e){P(Object(l.a)(Object(l.a)({},T),{},Object(r.a)({},e.target.name,e.target.value)))},z=function(){var t=Object(i.a)(a.a.mark((function t(){var c,s,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!T.imokapal||!T.tgldetensi){t.next=9;break}return t.next=3,b.a.from("td_detensi").select("*").eq("data->imokapal",JSON.stringify(T.imokapal)).eq("data->tgldetensi",JSON.stringify(T.tgldetensi));case 3:c=t.sent,s=c.data,c.error,s.length?h.a.fire({icon:"error",title:"Oops...",text:"Data Detensi tersebut Sudah Pernah Diajukan Sebelumnya"}):((i={}).imokapal=T.imokapal,i.tgldetensi=T.tgldetensi,e({type:"set",initial:i}),h.a.fire({icon:"success",title:"Validasi Sukses",html:"Anda Akan Diarahkan ke Halaman Selanjutnya",timer:1500,timerProgressBar:!0}).then((function(e){n.push("/hdpsc/new")}))),t.next=10;break;case 9:console.log(T.imokapal,T.tgldetensi);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(j.useEffect)(Object(i.a)(a.a.mark((function e(){var t,n,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.from("td_detensi").select("\n            id_detensi,\n            data,\n            fl_lock,\n            locked_by,\n            tr_status (\n                kd_status,\n                ur_status\n            ),\n            th_detensi (\n                kd_status,\n                created_at,\n                createdby,\n                locked_by\n            )\n        ");case 2:return t=e.sent,e.next=5,b.a.from("tr_status").select("\n            kd_status,\n            ur_status\n        ");case 5:n=e.sent,c=t.data.map((function(e){var t;return Object(l.a)(Object(l.a)(Object(l.a)(Object(r.a)({},"id_detensi",e.id_detensi),e.data),e.tr_status),{},(t={},Object(r.a)(t,"histori",e.th_detensi),Object(r.a)(t,"locked_by",e.locked_by),Object(r.a)(t,"fl_lock",e.fl_lock),t))})),_(c),console.log(n);case 9:case"end":return e.stop()}}),e)}))),[]),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(o.db,{show:D,onClose:function(){return K(!1)},children:[Object(m.jsx)(o.gb,{children:Object(m.jsx)("h5",{children:"Masukkan Data Awal"})}),Object(m.jsxs)(o.eb,{children:[Object(m.jsx)(o.tb,{children:Object(m.jsx)(o.u,{md:"12",children:Object(m.jsxs)(o.K,{children:[Object(m.jsx)(o.Z,{children:"Nomor IMO Kapal"}),Object(m.jsx)(o.P,{value:T.imokapal,name:"imokapal",onChange:function(e){return q(e)},type:"text"})]})})}),Object(m.jsx)(o.tb,{children:Object(m.jsx)(o.u,{md:"12",children:Object(m.jsxs)(o.K,{children:[Object(m.jsx)(o.Z,{children:"Tanggal Detensi"}),Object(m.jsx)(o.P,{value:T.tgldetensi,name:"tgldetensi",onChange:function(e){return q(e)},type:"date"})]})})})]}),Object(m.jsx)(o.fb,{children:Object(m.jsxs)("div",{className:"d-flex justify-content-end",children:[Object(m.jsx)("div",{className:"mr-2",children:Object(m.jsx)(o.f,{onClick:function(){return z()},color:"success",children:"Lanjutkan"})}),Object(m.jsx)("div",{className:"mr-2",children:Object(m.jsx)(o.f,{onClick:function(){return K(!1)},color:"danger",children:"Batal"})})]})})]}),Object(m.jsxs)(o.j,{children:[Object(m.jsx)(o.n,{children:Object(m.jsx)("h5",{children:"Data Detensi Kapal"})}),Object(m.jsxs)(o.k,{children:[1==A||2==A||3==A?Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"d-flex justify-content-end mb-2",children:Object(m.jsxs)(o.f,{onClick:function(){return K(!0)},className:"btn btn-info",children:["Buat Baru ",Object(m.jsx)("i",{class:"fas fa-plus"})]})})}):Object(m.jsx)(m.Fragment,{}),Object(m.jsx)(o.y,{addTableClasses:"josss",items:x,fields:[{key:"no",label:"No",_style:{width:"5%"}},{key:"namakapal",label:"Nama Kapal"},{key:"imokapal",label:"Nomor IMO Kapal"},{key:"tgldetensi",label:"Tanggal Detensi"},{key:"status",label:"Status"},{key:"lock",label:"Available ?",_style:{width:"15%"}},{key:"action",label:"Action"}],scopedSlots:{lock:function(e,n){var c,s;return s=e.locked_by==A?"Me":t[e.locked_by-1],c=e.fl_lock?"Checked Out by "+s:"Available",Object(m.jsx)("td",{children:c})},no:function(e,t){return Object(m.jsx)("td",{children:t+1})},status:function(e,t){return Object(m.jsx)("td",{children:Object(m.jsx)(o.b,{onClick:function(){!function(e){var t=w.indexOf(e),n=w.slice();-1!==t?n.splice(t,1):n=[].concat(Object(c.a)(w),[e]),N(n)}(t)},role:"button",color:C[parseInt(e.kd_status)-1],children:e.ur_status})})},action:function(e,n){console.log(e),console.log();var c,s=t[e.locked_by-1];return c=!!e.fl_lock&&e.locked_by!=A,Object(m.jsx)("td",{children:1!=A&&2!=A&&3!=A||3!=e.kd_status?1!=A&&2!=A&&3!=A||4==e.kd_status?1!=A&&2!=A&&3!=A||4!=e.kd_status?Object(m.jsx)(k,{}):Object(m.jsx)(p,Object(r.a)({datadetensi:e},"datadetensi",e)):Object(m.jsx)(y,{fl_lock:e.fl_lock,locker:s,disabled:c,datadetensi:e}):Object(m.jsx)(p,Object(r.a)({datadetensi:e},"datadetensi",e))})},details:function(e,n){return console.log(e),Object(m.jsx)(o.v,{show:w.includes(n),children:e.histori.map((function(e){var n=new Date(e.created_at),c=n.getDate(),s=n.getMonth()+1,a=n.getFullYear(),i=n.getHours(),r=n.getMinutes(),l=n.getSeconds();return Object(m.jsxs)("div",{className:"d-flex flex-row justify-content-end mx-3 my-3",children:[Object(m.jsx)("div",{className:"d-flex flex-column justify-content-center mr-2",children:Object(m.jsx)(o.b,{color:C[parseInt(e.kd_status)-1],children:1==e.kd_status?"Initial Info":2==e.kd_status?"Cetakan Form A & B":3==e.kd_status?"Data Elektronik Form A & B":4==e.kd_status?"Input Tanggal Release":""})}),Object(m.jsxs)("div",{style:{minWidth:"15vw"},className:"d-flex flex-column",children:[1==c.toString().length?"0"+c:c,"-",1==s.toString().length?"0"+s:s,"-",a," ",i,":",r,":",l]}),Object(m.jsx)("div",{style:{minWidth:"15vw"},className:"d-flex flex-column",children:t[parseInt(e.createdby)-1]})]})}))})}}})]})]})]})}}}]);
//# sourceMappingURL=31.fa97f6f7.chunk.js.map